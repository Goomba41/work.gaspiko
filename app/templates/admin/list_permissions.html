{% extends "admin/base_admin.html" %}
{% block content %}

{% if session['logged_in'] %}

    {% from "admin/_formhelpers.html" import flash_msg %}
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {{flash_msg(messages)}}
        {% endif %}
    {% endwith %}
    <ul class="nav nav-pills nav-justified">
      <li role="presentation" class="active"><a data-toggle="pill" href="#roles">Роли</a></li>
      <li role="presentation"><a data-toggle="pill" href="#users">Пользователи</a></li>
    </ul>
    <div class="tab-content">
        <div id="roles" class="tab-pane fade in active">
            <div class="col-sm-12">
                <table class="table table-striped table-bordered table-hover model-list" >
                    <tr>
                        <th>ID</th>
                        <th>Роль</th>
                        <th>Таблица</th>
                        <th>Модуль</th>
                        <th class="btn-primary">Доступ</th>
                        <th class="btn-success">Вставка</th>
                        <th class="btn-warning">Изменение</th>
                        <th class="btn-danger">Удаление</th>
                    </tr>
                    {% for permission_role in permissions_list_roles %}
                    <tr>
                        <td>{{ permission_role.id }}</td>
                        <td>{{ permission_role.role.name }}</td>
                        <td>{{ permission_role.table.name }}</td>
                        <td>{{ permission_role.table.module_parent.name }}</td>
                        <td><input type="checkbox" name="" class="checkbox" id="{{ permission_role.id }}-enter" title="Переключение разрешения" {% if permission_role.enter %}checked="checked"{% endif %}></td>
                        <td><input type="checkbox" name="" class="checkbox" id="{{ permission_role.id }}-insert" title="Переключение разрешения" {% if permission_role.insert %}checked="checked"{% endif %}></td>
                        <td><input type="checkbox" name="" class="checkbox" id="{{ permission_role.id }}-update" title="Переключение разрешения" {% if permission_role.update %}checked="checked"{% endif %}></td>
                        <td><input type="checkbox" name="" class="checkbox" id="{{ permission_role.id }}-delete" title="Переключение разрешения"{% if permission_role.delete %}checked="checked"{% endif %}></td>
                    </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
        <div id="users" class="tab-pane fade">

        </div>
    </div>


    <br style="clear: both;"/>

    <script>
        $(document).ready(function() {

            $('.checkbox').change(function() {
                $.post( "/update_permission", {
                    permission: this.id,
                    state: this.checked,
                })
            });

        });
    </script>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {{flash_msg(messages)}}
        {% endif %}
    {% endwith %}

{% endif %}

{% endblock %}
